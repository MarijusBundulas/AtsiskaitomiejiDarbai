"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TwingNodeVisitorMacroAutoImport = void 0;
const base_node_visitor_1 = require("../base-node-visitor");
const name_1 = require("../node/expression/name");
const method_call_1 = require("../node/expression/method-call");
const get_attribute_1 = require("../node/expression/get-attribute");
const constant_1 = require("../node/expression/constant");
class TwingNodeVisitorMacroAutoImport extends base_node_visitor_1.TwingBaseNodeVisitor {
    doEnterNode(node, env) {
        return node;
    }
    doLeaveNode(node, env) {
        if ((node.type == get_attribute_1.type) && (node.getNode('node').is(name_1.type)) && (node.getNode('node').getAttribute('name') === '_self') && (node.getNode('attribute').is(constant_1.type))) {
            let name = node.getNode('attribute').getAttribute('value');
            node = new method_call_1.TwingNodeExpressionMethodCall(node.getNode('node'), name, node.getNode('arguments'), node.getTemplateLine(), node.getTemplateColumn());
            node.setAttribute('safe', true);
        }
        return node;
    }
    getPriority() {
        // we must run before auto-escaping
        return -10;
    }
}
exports.TwingNodeVisitorMacroAutoImport = TwingNodeVisitorMacroAutoImport;
